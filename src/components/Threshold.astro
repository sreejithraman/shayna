---
/**
 * Threshold.astro â€” Hero section with scroll-driven name transition
 *
 * Three phases:
 * 1. Hero (0-85vh): Large centered name over photo
 * 2. Transition (85vh-140vh): Name shrinks and moves to nav position
 * 3. Locked (140vh+): Name fixed as nav logo
 */
interface Props {
  heroImage?: string;
}

const { heroImage = '/images/shayna-hero-placeholder.svg' } = Astro.props;
---

<section class="relative h-[200vh]" id="threshold">
  <!-- Photo layer (fixed, behind content) -->
  <div
    class="fixed inset-0 flex items-center justify-center pointer-events-none z-10 will-change-transform"
    id="photo-container"
  >
    <div class="relative" id="photo-wrapper">
      <img
        src={heroImage}
        alt="Shayna Dunkelman"
        class="object-cover w-[min(400px,80vw)] h-[min(550px,75vh)] grayscale-[15%] contrast-[1.05] brightness-[0.9]"
        id="hero-photo"
      />
      <!-- Bottom fade gradient -->
      <div class="absolute inset-x-0 bottom-0 h-[60%] bg-gradient-to-t from-void to-transparent"></div>
    </div>
  </div>

  <!-- Name element (the h1 that transitions) -->
  <h1
    class="fixed z-20 font-sans font-light text-primary will-change-transform"
    id="threshold-name"
    style="
      font-size: clamp(32px, 8vw, 64px);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    "
  >
    <a href="/" class="hover:text-secondary transition-colors duration-300">
      Shayna Dunkelman
    </a>
  </h1>

  <!-- Scroll hint -->
  <div
    class="fixed bottom-8 left-1/2 -translate-x-1/2 z-20 flex flex-col items-center gap-2"
    id="scroll-hint"
  >
    <span class="font-mono text-[10px] uppercase tracking-wider text-muted">
      Scroll
    </span>
    <div class="w-px h-6 bg-muted/50 animate-pulse"></div>
  </div>
</section>

<!-- Content below threshold -->
<div id="main-content">
  <slot />
</div>

<script>
  import { initThreshold } from '@/scripts/threshold';
  import { initPhotoInteraction } from '@/scripts/photo-interaction';

  // Only initialize if reduced motion is not preferred
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReducedMotion) {
    // Initialize after DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      initThreshold();
      initPhotoInteraction();
    });

    // Also run immediately if DOM is already loaded
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      initThreshold();
      initPhotoInteraction();
    }
  } else {
    // For reduced motion: just position name in nav position
    const nameEl = document.getElementById('threshold-name');
    const photoContainer = document.getElementById('photo-container');
    const scrollHint = document.getElementById('scroll-hint');

    if (nameEl) {
      nameEl.style.fontSize = '14px';
      nameEl.style.top = '24px';
      nameEl.style.left = '40px';
      nameEl.style.transform = 'none';
    }
    if (photoContainer) {
      photoContainer.style.opacity = '0';
    }
    if (scrollHint) {
      scrollHint.style.display = 'none';
    }
  }
</script>

<style>
  /* GPU acceleration hints */
  #photo-container,
  #photo-wrapper,
  #threshold-name {
    will-change: transform, opacity;
  }

  /* Ensure smooth transitions */
  #threshold-name {
    white-space: nowrap;
  }
</style>
